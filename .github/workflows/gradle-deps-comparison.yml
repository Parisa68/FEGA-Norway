name: Compare Dependencies

on:
  pull_request:
    types: [closed]

jobs:
  check-deps:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest

    steps:
    - name: checkout pr branch
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Set up JDK
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '21'

    - name: Compare Gradle Dependencies
      run: |
        BASE_REF=${{ github.event.pull_request.base.sha }}
        HEAD_REF=${{ github.event.pull_request.head.sha }}

        git checkout "$BASE_REF"
        ./gradlew :lib:clearinghouse:dependencies > /tmp/before.txt

        echo "Checking out head ref: $HEAD_REF"
        git checkout "$HEAD_REF"
        ./gradlew :lib:clearinghouse:dependencies > /tmp/after.txt

        echo "/////////////////////////////////"
        cat /tmp/before.txt
        cat /tmp/after.txt
        
        if diff /tmp/before.txt /tmp/after.txt; then
          echo "no"
        else
          echo "yes"
        fi
